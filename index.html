<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Behlul & Inci</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

  <style>
    html, body{
      margin:0; padding:0;
      width:100%; height:100%;
      overflow:hidden;
      background:#000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    #introWrap{
      position:fixed;
      inset:0;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    #introVideo{
      width:100%;
      height:100%;
      object-fit:cover;
      background:#000;
    }

    #tapToStart{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      padding:14px 22px;
      border-radius:999px;
      background:rgba(0,0,0,0.6);
      color:#fff;
      font-size:18px;
      border:1px solid rgba(255,255,255,0.35);
      display:none;
      user-select:none;
      animation:pulse 1.4s infinite;
    }
    @keyframes pulse{
      0%{opacity:0.55;}
      50%{opacity:1;}
      100%{opacity:0.55;}
    }

    canvas{ display:block; touch-action:none; }
  </style>
</head>

<body>

  <div id="introWrap">
    <video id="introVideo" playsinline preload="auto">
      <source src="assets/intro.mp4?v=2" type="video/mp4" />
    </video>
    <div id="tapToStart">İzlemek için dokunun ▶</div>
  </div>

<script>
/* ==========================
   0) INTRO VIDEO
   ========================== */
const introWrap  = document.getElementById("introWrap");
const introVideo = document.getElementById("introVideo");
const tapToStart = document.getElementById("tapToStart");

async function tryPlayIntro(){
  try{
    introVideo.muted = false;
    introVideo.volume = 1.0;
    const pr = introVideo.play();
    if (pr) await pr;
  }catch(e){
    tapToStart.style.display = "block";
  }
}
tapToStart.addEventListener("click", async () => {
  tapToStart.style.display = "none";
  try{
    introVideo.muted = false;
    introVideo.volume = 1.0;
    await introVideo.play();
  }catch(e){}
}, { passive:true });

introVideo.addEventListener("ended", () => {
  introWrap.style.display = "none";
  startGame();
});
tryPlayIntro();

/* ==========================
   1) GAME (p5.js)
   ========================== */
let bgImg, catImg, sharkImg, levelUpImg;

// Sounds
let levelUpSound; // assets/levelup.mp3
let pingSound;    // assets/ping.mp3
let hitSound;     // assets/hit.mp3

let state = "START"; // START, PLAYING, LEVELPAUSE, GAMEOVER
let scaleFactor = 1;

// Game stats
const game = { score: 0, lives: 3, level: 1 };

// Time + Best Time
let startTime = 0;
let elapsedTime = 0;
let bestTime = 0;
const BEST_TIME_KEY = "behlul_best_time_v1";

const TOUCH_X_OFFSET = -14;

// Level up anim
let levelUpText = "";
let levelUpTimer = 0; // ms

// ✅ Input lock (Start’a basınca ilk dokunuş kediyi parmağa çekmesin)
let inputLockUntilMs = 0;

// ✅ Level pause bookkeeping
let pendingLevel = 1;
let pauseStartMs = 0;

// Player
const player = { x: 0, y: 0, r: 0 };
let CAT_SIZE = 160;

// Shark
const shark = {
  x: 0, y: 0,
  w: 0, h: 0,
  angle: 0,
  gapAngle: 0,
  gapSize: 1.25
};

// ✅ Mouth radii (0.38 istediğin ağız içi)
const MOUTH_INNER_RATIO = 0.38; // ağız boşluğu büyüklüğü
const MOUTH_OUTER_RATIO = 0.50; // dış sınır

// Target scoring
let TARGET_R = 18;
let inMouth = false;        // ✅ artık ring değil, ağız boşluğu
let scoredThisEntry = false;

// Smooth snap (level up spawn)
let snapActive = false;
let snapStartMs = 0;
let snapDurMs = 220;
let snapFromX = 0, snapFromY = 0;
let snapToX = 0, snapToY =
