<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Behlul & Inci</title>

  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* INTRO */
    #introWrap {
      position: fixed;
      inset: 0;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    #introVideo {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* TAP TO START */
    #tapToStart {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 14px 22px;
      border-radius: 999px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      font-size: 18px;
      border: 1px solid rgba(255,255,255,0.35);
      display: none;
      user-select: none;
      animation: pulse 1.4s infinite;
    }

    @keyframes pulse {
      0%   { opacity: 0.55; }
      50%  { opacity: 1; }
      100% { opacity: 0.55; }
    }

    canvas {
      display: block;
      touch-action: none;
    }
  </style>
</head>

<body>

<!-- INTRO -->
<div id="introWrap">
  <video id="introVideo" playsinline preload="auto">
    <source src="assets/intro.mp4" type="video/mp4">
  </video>

  <!-- İSTENEN YAZI -->
  <div id="tapToStart">İzlemek için dokunun ▶</div>
</div>

<script>
/* ================= INTRO LOGIC ================= */
const introWrap  = document.getElementById("introWrap");
const introVideo = document.getElementById("introVideo");
const tapToStart = document.getElementById("tapToStart");

async function tryPlayIntro() {
  try {
    introVideo.muted = false;
    introVideo.volume = 1.0;
    const p = introVideo.play();
    if (p) await p;
  } catch (e) {
    tapToStart.style.display = "block";
  }
}

tapToStart.addEventListener("click", async () => {
  tapToStart.style.display = "none";
  try {
    introVideo.muted = false;
    introVideo.volume = 1.0;
    await introVideo.play();
  } catch (e) {}
});

introVideo.addEventListener("ended", () => {
  introWrap.style.display = "none";
  startGame();
});

tryPlayIntro();

/* ================= GAME ================= */
let bgImg, catImg, sharkImg;
let state = "START";
let scaleFactor = 1;

const game = { score: 0, lives: 3, level: 1 };
const TOUCH_X_OFFSET = -14;

const player = { x: 0, y: 0, r: 52 };

const shark = {
  x: 0, y: 0,
  w: 520, h: 520,
  gapAngle: 0,
  gapSize: 1.1
};

function startGame() {
  new p5(p => {

    p.preload = () => {
      bgImg    = p.loadImage("assets/background.jpg");
      catImg   = p.loadImage("assets/cat.png");
      sharkImg = p.loadImage("assets/shark.png");
    };

    p.setup = () => {
      p.createCanvas(p.windowWidth, p.windowHeight);
      p.imageMode(p.CENTER);
      p.angleMode(p.RADIANS);
      resetAll(p);
    };

    p.windowResized = () => {
      p.resizeCanvas(p.windowWidth, p.windowHeight);
      resetAll(p, true);
    };

    p.draw = () => {
      drawBackground(p);

      if (state === "START") return drawOverlay(p);
      if (state === "GAMEOVER") return drawOverlay(p, true);

      updateGame(p);
      renderGame(p);
    };

    p.touchStarted = p.mousePressed = () => {
      if (state === "START") state = "PLAYING";
      else if (state === "GAMEOVER") resetAll(p);
      return false;
    };
  });
}

function resetAll(p, keepState=false) {
  scaleFactor = Math.min(p.width, p.height) / 700;

  game.score = 0;
  game.lives = 3;
  game.level = 1;

  player.r = 52 * scaleFactor;
  player.x = p.width * 0.25;
  player.y = p.height * 0.5;

  shark.w = shark.h = 520 * scaleFactor;
  shark.x = p.width / 2;
  shark.y = p.height / 2;
  shark.gapAngle = -0.3;
  shark.gapSize = 1.1;

  state = keepState ? state : "START";
}

function drawBackground(p) {
  if (!bgImg) return p.background(0);

  const cw = p.width, ch = p.height;
  const iw = bgImg.width, ih = bgImg.height;
  const cr = cw / ch, ir = iw / ih;

  let dw, dh;
  if (ir > cr) { dh = ch; dw = dh * ir; }
  else { dw = cw; dh = dw / ir; }

  p.image(bgImg, cw/2, ch/2, dw, dh);
}

function updateGame(p) {
  const tx = (p.touches[0]?.x ?? p.mouseX) + TOUCH_X_OFFSET;
  const ty = (p.touches[0]?.y ?? p.mouseY);

  player.x = lerp(player.x, clamp(tx, player.r, p.width-player.r), 0.25);
  player.y = lerp(player.y, clamp(ty, player.r, p.height-player.r), 0.25);

  shark.gapAngle += 0.02 + game.level * 0.002;
  shark.gapSize = Math.max(0.7, 1.1 - game.level * 0.05);

  if (collides()) loseLife();
}

function renderGame(p) {
  p.push();
  p.translate(shark.x, shark.y);
  p.rotate(shark.gapAngle);
  p.image(sharkImg, 0, 0, shark.w, shark.h);
  p.pop();

  const catSize = 160 * scaleFactor;
  p.image(catImg, player.x, player.y, catSize, catSize);
}

function drawOverlay(p, gameOver=false) {
  p.fill(0,0,0,160);
  p.rect(0,0,p.width,p.height);

  p.fill(255);
  p.textAlign(p.CENTER,p.CENTER);
  p.textSize(48*scaleFactor);
  p.text("Behlul & Inci", p.width/2, p.height/2-20);

  p.textSize(22*scaleFactor);
  p.text("Tekrar denemek için dokun", p.width/2, p.height/2+40);
}

function loseLife() {
  if (loseLife.lock) return;
  loseLife.lock = true;
  game.lives--;
  setTimeout(()=>loseLife.lock=false, 500);
  if (game.lives <= 0) state = "GAMEOVER";
}

function collides() {
  const dx = player.x - shark.x;
  const dy = player.y - shark.y;
  const d  = Math.sqrt(dx*dx + dy*dy);

  const outer = shark.w * 0.5;
  const inner = shark.w * 0.22;
  if (d + player.r < inner || d - player.r > outer) return false;

  const a  = Math.atan2(dy, dx);
  const a0 = norm(shark.gapAngle - shark.gapSize/2);
  const a1 = norm(shark.gapAngle + shark.gapSize/2);

  return !(between(a,a0,a1));
}

function norm(a){ while(a<-Math.PI)a+=Math.PI*2; while(a>Math.PI)a-=Math.PI*2; return a; }
function between(a,s,e){ return s<=e ? (a>=s&&a<=e) : (a>=s||a<=e); }
function clamp(v,mn,mx){ return Math.max(mn,Math.min(mx,v)); }
function lerp(a,b,t){ return a+(b-a)*t; }
</script>

</body>
</html>
